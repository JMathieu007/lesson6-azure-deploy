name: Cleanup Azure Resources
on:
  workflow_dispatch:
 
jobs:
  destroy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
 
      - uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
 
      - name: Destroy via Terraform (best effort)
        run: |
          set +e
          cd terraform || exit 0
          terraform init -lock=false || true
          terraform destroy -auto-approve -lock=false || true
          exit 0
 
      - name: Force delete groups
        run: |
          az group delete -n lesson6-rg -y --no-wait || true
          az group delete -n tfstate-rg -y --no-wait || true
